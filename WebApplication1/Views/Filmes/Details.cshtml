@model MovieWeatherViewModel
@{
    ViewData["Title"] = Model.Movie.Title;
    var movie = Model.Movie;
    var weather = Model.Weather;
}

<div class="container mt-5">

    @* --- Cabeçalho e Metadata do Filme --- *@
    <div class="row mb-4">
        <div class="col-md-12">
            <h1>@movie.Title</h1>
            @* CORREÇÃO: ReleaseDate é string. Usamos uma função TryParse aqui para o ano, se necessário, ou mostramos a string pura. *@
            <p class="lead text-muted">Lançamento: @movie.ReleaseDate</p>
            <hr />
        </div>
    </div>

    <div class="row">
        @* Coluna da Imagem *@
        <div class="col-md-4">
            @{
                var imageBaseUrl = "https://image.tmdb.org/t/p/w500";
                // CORREÇÃO: PosterPath existe no MovieDetail.
                var posterUrl = !string.IsNullOrEmpty(movie.PosterPath)
                ? imageBaseUrl + movie.PosterPath
                : "/images/placeholder.png";
            }
            <img src="@posterUrl" class="img-fluid rounded shadow-lg" alt="@movie.Title" />

            <div class="mt-3">
                <p><strong>Gêneros:</strong> @string.Join(", ", movie.Genres.Select(g => g.Name))</p>
            </div>
        </div>

        @* Coluna de Detalhes e Clima *@
        <div class="col-md-8">

            @* --- Detalhes do Filme --- *@
            <h3 class="mb-3">Sinopse</h3>
            @* CORREÇÃO: Overview existe no MovieDetail. *@
            <p>@movie.Overview</p>

            <dl class="row mt-4">
                <dt class="col-sm-4">ID TMDb</dt>
                <dd class="col-sm-8">@movie.Id</dd>

                <dt class="col-sm-4">Data de Lançamento</dt>
                @* CORREÇÃO: ReleaseDate existe no MovieDetail. *@
                <dd class="col-sm-8">@movie.ReleaseDate</dd>

                <dt class="col-sm-4">Duração</dt>
                @* CORREÇÃO: Runtime existe no MovieDetail. *@
                <dd class="col-sm-8">
                    @if (movie.Runtime.HasValue && movie.Runtime.Value > 0)
                    {
                        <span>@movie.Runtime.Value minutos</span>
                    }
                    else
                    {
                        <span>N/A</span>
                    }
                </dd>

                <dt class="col-sm-4">Nota Média</dt>
                @* CORREÇÃO: VoteAverage existe no MovieDetail. *@
                <dd class="col-sm-8">@movie.VoteAverage.ToString("F1") / 10 (@movie.VoteCount votos)</dd>

                @* CORREÇÃO: VoteCount existe no MovieDetail. *@
                @* <dt class="col-sm-4">Total de Votos</dt>
                <dd class="col-sm-8">@movie.VoteCount</dd> *@
            </dl>

            @* --- Partial de Clima --- *@
            <hr />
            <h3 class="mb-3">Previsão do Tempo para (@weather.City)</h3>
            @await Html.PartialAsync("_WeatherPartial", weather)

        </div>
    </div>
</div>